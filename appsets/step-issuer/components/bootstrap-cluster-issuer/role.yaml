# ClusterRole for creating the cluster-scoped StepClusterIssuer resource
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: step-ca-bootstrap-cluster-issuer
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: BeforeHookCreation
    argocd.argoproj.io/sync-wave: "5"
rules:
  - apiGroups: ["certmanager.step.sm"]
    resources: ["stepclusterissuers"]
    verbs: ["get", "create", "update", "patch"]
---
# Namespace-scoped Role for Secret access in step-ca namespace
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: step-ca-bootstrap-cluster-issuer
  namespace: step-ca
  annotations:
    argocd.argoproj.io/hook: PostSync
    argocd.argoproj.io/hook-delete-policy: BeforeHookCreation
    argocd.argoproj.io/sync-wave: "5"
rules:
  - apiGroups: [""]
    resources: ["secrets"]
    verbs: ["get", "list", "watch"]
